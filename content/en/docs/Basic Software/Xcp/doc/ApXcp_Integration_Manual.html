---
title: ApXcp_Integration_Manual
linkTitle: ApXcp_Integration_Manual
weight: 2
---

<p><a href="#dependencies">1 Dependencies <span>2</span></a></p>
<p><a href="#_Toc357692819">1.1 SWCs <span>2</span></a></p>
<p><a href="#_Toc357692820">1.2 Functions to be provided to Integration Project <span>2</span></a></p>
<p><a href="#getsetindexes-and-getpersindexes">2 Configuration <span>3</span></a></p>
<p><a href="#build-time-config">2.1 Build Time Config <span>3</span></a></p>
<p><a href="#configuration-files-to-be-provided-by-integration-project">2.2 Configuration Files to be provided by Integration Project <span>3</span></a></p>
<p><a href="#da-vinci-parameter-configuration-changes">2.2.1 Da Vinci Config generation <span>3</span></a></p>
<p><a href="#da-vinci-parameter-configuration-changes">2.2.2 Manual Configuration Changes <span>3</span></a></p>
<p><a href="#integration">3 Integration <span>4</span></a></p>
<p><a href="#required-global-data-inputs">3.1 Required Global Data Inputs <span>4</span></a></p>
<p><a href="#_Toc357692828">3.2 Optional Global Data Inputs <span>4</span></a></p>
<p><a href="#specific-include-path-present">3.3 Specific Include Path present <span>4</span></a></p>
<p><a href="#runnable-scheduling">4 Runnable Scheduling <span>5</span></a></p>
<p><a href="#memory-mapping">5 Memory Mapping <span>6</span></a></p>
<p><a href="#mapping">5.1 Mapping <span>6</span></a></p>
<p><a href="#usage">5.2 Usage <span>6</span></a></p>
<p><a href="#non-rte-nvm-blocks">5.3 NvM Blocks <span>6</span></a></p>
<p><a href="#compiler-settings">6 Compiler Settings <span>6</span></a></p>
<p><a href="#preprocessor-macro">6.1 Preprocessor MACRO <span>6</span></a></p>
<p><a href="#optimization-settings">6.2 Optimization Settings <span>6</span></a></p>
<p><a href="#revision-control-log">7 Revision Control Log <span>7</span></a></p>
<h1 id="dependencies">Dependencies</h1>
<h2 id="getsetindexes-and-getpersindexes">GetSetIndexes() and GetPersIndexes()</h2>
<h3 id="overview">Overview</h3>
<p>The integration specific functions below, GetSetIndexes and GetPersIndexes, are used to return an array of tuning identifiers to the tune-on-the-fly (or online calibration as defined in the XCP specs) function. They are used to copy the active sets or personalities into RAM. The functions should be implemented in an integration specific component that determines the desired personality and desired set identifiers sent to tuning select authority SWC.</p>
<p>If tune-on-the-fly functionality is disabled, the functions below do not need to be defined.</p>
<p>If tune-on-the-fly is enabled and the lookup functions are disabled, the functions below do not need to be defined. When a copy cal page XCP command is called, the personalities are copied from 0 to a max limit based on the active tuning set that is currently being used. In the case of the tuning sets being copied, only the active tuning set is copied in to the RAM.</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Module</strong></th>
<th><strong>Required API</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>&lt;Integration Specific Module&gt;</strong></td>
<td>Function outline defined below:</td>
</tr>
</tbody>
</table>
<h3 id="function-prototypes">Function Prototypes</h3>
<p>The actual implementation of the function will vary between programs. However, the function should be structured so the passed arguments are of the same time to provide a common interface to the XCP functions.</p>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 35%" />
<col style="width: 8%" />
<col style="width: 5%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>GetSetIndexes or GetPersndexes</td>
<td>Type</td>
<td>Dir.</td>
<td>Min</td>
<td>Max</td>
<td>UTP Tol.</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>NumOfSets_Cnt_T_u8<br />
or<br />
NumOfPers_Cnt_T_u8</td>
<td>uint8</td>
<td>I</td>
<td>0</td>
<td>255</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>data</td>
<td>uint8*</td>
<td>I/O</td>
<td>0</td>
<td>255</td>
<td></td>
</tr>
<tr class="even">
<td><strong>Return Value</strong></td>
<td>N/A</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="example-1----bmw">Example 1 -- BMW</h3>
<p>The following example illustrates a similar situation found in the BMW program. Active personalities are determined by coding bits. Using the GetPersIndexes function, the function will loop through the personalities to find the index of the personality that contains the matching coding ID. The indexes are returned and the active personalities are copied into RAM.</p>
<p><img src="ElectricPowerSteering_TMS570_FIAT_321_website/static/media/image1.emf" /></p>
<h2 id="processxcppid">ProcessXCPPID()</h2>
<h3 id="overview-1">Overview</h3>
<p>This function must be available to this module to call by the integration manual. This should be provided by the CMS component which does the processing on XCP PIDs. This function is required to allow the CMS component to figure out when an XCP PID is finished being read or written.</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Module</strong></th>
<th><strong>Required API</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>CMS Common</strong></td>
<td>Function outline defined below:</td>
</tr>
</tbody>
</table>
<h3 id="function-prototypes-1">Function Prototypes</h3>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 35%" />
<col style="width: 8%" />
<col style="width: 5%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>ProcessXCPPID</td>
<td>Type</td>
<td>Dir.</td>
<td>Min</td>
<td>Max</td>
<td>UTP Tol.</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>Size_Cnt_T_u08</td>
<td>uint8</td>
<td>I</td>
<td>1</td>
<td>8</td>
<td></td>
</tr>
<tr class="odd">
<td><strong>Return Value</strong></td>
<td>N/A</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="configuration">Configuration</h1>
<h2 id="build-time-config">Build Time Config</h2>
<table style="width:100%;">
<colgroup>
<col style="width: 36%" />
<col style="width: 53%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="header">
<th>Modules</th>
<th>Notes</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="configuration-files-to-be-provided-by-integration-project">Configuration Files to be provided by Integration Project</h2>
<h3 id="da-vinci-parameter-configuration-changes">Da Vinci Parameter Configuration Changes</h3>
<table>
<colgroup>
<col style="width: 45%" />
<col style="width: 43%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Notes</th>
<th>SWC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>D_NUMOFVLDEEMEMRGNS_CNT_U08</td>
<td>Generated in Ap_ApXcp.Cfg.h if external EEPROM access is set to STD_ON in Configurator. Value will be determined by the EEPROM memory access defined in the ECUC file.</td>
<td>ApXcp</td>
</tr>
<tr class="even">
<td>BC_XCP_EXTEEPACCESS</td>
<td>Set to STD_ON in Configurator if XCP access to external EEPROM is required.</td>
<td>ApXcp</td>
</tr>
<tr class="odd">
<td>BC_XCP_TUNEONFLY</td>
<td>Set to STD_ON in Configuartor if tune-on-the-fly support is required.</td>
<td>ApXcp</td>
</tr>
<tr class="even">
<td>BC_XCP_PERSINDEXLOOKUP</td>
<td>Set to STD_ON in Configurator if a function call to GetPersIndexes is required to return the indexes of active personalities. Note: BC_XCP_TUNEONFLY must be set to STD_ON</td>
<td>ApXcp</td>
</tr>
<tr class="odd">
<td>BC_XCP_SETINDEXLOOKUP</td>
<td>Set to STD_ON in Configurator if a function call to GetSetIndexes is required to return the indexes of active sets. Note: BC_XCP_TUNEONFLY must be set to STD_ON</td>
<td>ApXcp</td>
</tr>
<tr class="even">
<td>&lt;Non Trusted Function Stack Size&gt;</td>
<td>This needs to be configured (to a non-zero value) for the task or ISR that handles the XCP commands. This is required to support application switching for XCP writes. Please note this is only required if a program has non-trusted applications configured.</td>
<td>Os</td>
</tr>
<tr class="odd">
<td>&lt;Trusted/Non Trusted functions for XCP writes&gt;</td>
<td><p>If a program has multiple applications configured, non-trusted or trusted functions must be configured for each application. This is required to allow the XCP write commands to switch context before performing the write. These functions should end up calling ApXcpWriteCommon() to perform the write.</p>
<p>Ex:</p>
<p>NtWrapS_XcpWriteAp8()</p>
<p>NtWrapS_XcpWriteAp9()</p>
<p>TWrapS_XcpWriteAp0</p></td>
<td>Os</td>
</tr>
<tr class="even">
<td>BC_XCP_TOTFRAMSIZE_UNT_32</td>
<td>This should be set to the same size as the amount of RAM allocated to TOTF. Also used as the size of the buffer if Segment16 is enabled.</td>
<td>ApXcp</td>
</tr>
<tr class="odd">
<td>BC_XCP_SEG[x]ENABLE</td>
<td>This should be set to STD_ON to enable the number segment, where [x] = Segment number.</td>
<td>ApXcp</td>
</tr>
<tr class="even">
<td>BC_XCP_MAXPERCOPY_CNT_U8</td>
<td>Used with segment 0, the number represents the number of tuning personalities to copy into RAM. Must be set to at least 1.</td>
<td>ApXcp</td>
</tr>
<tr class="odd">
<td>CalConstNumOfPerSymbol</td>
<td>Set to the number of tuning personalties constant. Typically this is defined in CalConstants.h with the name D_NUMOFPERS_CNT_U16.</td>
<td>ApXcp</td>
</tr>
<tr class="even">
<td>BC_XCP_MAXSETCOPY_CNT_U8</td>
<td>Used with segment 1, the number represents the number of tuning sets to copy into RAM. Must be set to at least 1.</td>
<td>ApXcp</td>
</tr>
<tr class="odd">
<td>CalConstNumOfSetSymbol</td>
<td>Set to the number of tuning sets constant. Typically this is defined in CalConstants.h with the name D_NUMOFTUNSETS_CNT_U16.</td>
<td>ApAcp</td>
</tr>
<tr class="even">
<td>BC_XCP_SEG16LNKSYMB</td>
<td>Used with segment 16. The linker symbol represents the start address of the custom memory range to copy into RAM.</td>
<td>ApXcp</td>
</tr>
<tr class="odd">
<td>BC_XCP_SEG16LNKSYMBLEN_CNT_U8</td>
<td>Used with segment 16. The linker symbol represents the size of the custom memory range to copy into RAM.</td>
<td>ApXcp</td>
</tr>
</tbody>
</table>
<h3 id="davinci-interrupt-configuration-changes">DaVinci Interrupt Configuration Changes</h3>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 9%" />
<col style="width: 38%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th>ISR Name</th>
<th>VIM #</th>
<th>Priority Dependency</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="manual-configuration-changes">Manual Configuration Changes</h3>
<table>
<colgroup>
<col style="width: 39%" />
<col style="width: 47%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th>Constant</th>
<th>Notes</th>
<th>SWC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="geny-configuration-changes">GENy Configuration Changes</h3>
<table>
<colgroup>
<col style="width: 39%" />
<col style="width: 46%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Notes</th>
<th>SWC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>User configuration file</td>
<td><p>ApXcp component functionality relies on a callout function for XCP memory writing from the XCP module as delivered by vector. To enable this callout function, a user configuration file typically needs to be included in the GENy configuration to enable the appropriate build constant. See attached file below</p>
<p><img src="ElectricPowerSteering_TMS570_FIAT_321_website/static/media/image2.wmf" /></p></td>
<td>GENy XCP configuration</td>
</tr>
<tr class="even">
<td>General Settings-&gt;Enable Calibration</td>
<td>This should be enabled to allow download commands</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="odd">
<td>General Settings-&gt;Memory Write Protection</td>
<td>This should be enabled to allow checking of XCP access on the addresses requested for writing.</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="even">
<td>General Settings-&gt;Memory Read Protection</td>
<td>This should be enabled to allow checking of XCP access on the addresses requested for reading.</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="odd">
<td>EEPROM Access-&gt;Read Access</td>
<td>This needs to be enabled if external EEPROM is available and needs to be read through XCP</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="even">
<td>EEPROM Access-&gt;Write Access</td>
<td>This needs to be enabled if external EEPROM is available and needs to be written through XCP</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="odd">
<td>Standard Commands-&gt;User Defined Command</td>
<td>This needs to be enabled for CMS XCP support</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="even">
<td>Block Transfer-&gt;Block Upload</td>
<td>Needs to be enabled to support large XCP PID reads</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="odd">
<td>Block Transfer-&gt;Block Download</td>
<td>Needs to be enabled to support large XCP PID writes</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="even">
<td>Page Switching-&gt;Page Switching</td>
<td>Needs to be enabled only if Tune On the Fly Support is turned on</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="odd">
<td>Page Switching-&gt;General Paging Info</td>
<td>Needs to be enabled only if Tune On the Fly Support is turned on</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="even">
<td>Page Switching-&gt;Copy Page</td>
<td>Needs to be enabled only if Tune On the Fly Support is turned on</td>
<td>GENy XCP configuration</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="integration">Integration</h1>
<h2 id="required-global-data-inputs">Required Global Data Inputs</h2>
<p>&lt;Mention any global variable that this component requires for other components&gt;</p>
<h2 id="required-global-data-outputs">Required Global Data Outputs</h2>
<p>&lt;Mention any global variable that this component requires for other components&gt;</p>
<h2 id="specific-include-path-present">Specific Include Path present</h2>
<p>Yes</p>
<h1 id="runnable-scheduling">Runnable Scheduling </h1>
<p>This section specifies the required runnable scheduling.</p>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 53%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header">
<th>Init</th>
<th>Scheduling Requirements</th>
<th>Trigger</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ApXcp_Init</td>
<td>Should be called prior to the start of the O/S (typically EcuStartup_Init1)</td>
<td>Once At Init</td>
</tr>
</tbody>
</table>
<table style="width:100%;">
<colgroup>
<col style="width: 25%" />
<col style="width: 54%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="header">
<th>Runnable</th>
<th>Scheduling Requirements</th>
<th>Trigger</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ApXcp_Per1</td>
<td>None</td>
<td>RTE (10ms)</td>
</tr>
<tr class="even">
<td>DAQ_2msTL</td>
<td></td>
<td>RTE (2ms)</td>
</tr>
<tr class="odd">
<td>DAQ_1msTL</td>
<td>This function should only be scheduled if 1ms DAQ support is required. If not, it needs to be deleted from the integration project in the ApXcp Component.</td>
<td>RTE (1ms)</td>
</tr>
</tbody>
</table>
<p><strong>.</strong></p>
<h1 id="memory-mapping">Memory Mapping</h1>
<h2 id="mapping">Mapping</h2>
<table>
<colgroup>
<col style="width: 45%" />
<col style="width: 26%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="header">
<th>Memory Section</th>
<th>Contents</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt; Memory mapping Info&gt;</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>* Each …START_SEC… constant is terminated by a …STOP_SEC… constant as specified in the AUTOSAR Memory Mapping requirements.</p>
<h2 id="usage">Usage</h2>
<table>
<colgroup>
<col style="width: 55%" />
<col style="width: 23%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>RAM</th>
<th>ROM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt;Memmap usuage info&gt;</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Table 1: ARM Cortex R4 Memory Usage</p>
<h2 id="non-rte-nvm-blocks">Non RTE NvM Blocks</h2>
<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="header">
<th>Block Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt;NVM block used Non RTE functions &gt;</td>
</tr>
</tbody>
</table>
<p>Note : Size of the NVM block if configured in developer</p>
<h2 id="rte-nvm-blocks"> RTE NvM Blocks</h2>
<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="header">
<th>Block Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt;NVM block used in RTE functions &gt;</td>
</tr>
</tbody>
</table>
<p>Note : Size of the NVM block if configured in developer</p>
<h1 id="compiler-settings">Compiler Settings</h1>
<h2 id="preprocessor-macro"> Preprocessor MACRO</h2>
<p>&lt;Define all the preprocessor Macros needed and conditions when needed&gt;.</p>
<h2 id="optimization-settings">Optimization Settings</h2>
<p>&lt;Define Optimization levels that are needed and conditions when needed&gt;.</p>
<h2 class="unnumbered" id="section"></h2>
<h1 id="revision-control-log">Revision Control Log</h1>
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 71%" />
<col style="width: 12%" />
<col style="width: 8%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Rev #</strong></td>
<td><strong>Change Description</strong></td>
<td><strong>Date</strong></td>
<td><strong>Author</strong></td>
</tr>
<tr class="even">
<td>1</td>
<td>Initial version</td>
<td>30-July-13</td>
<td>KJS</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Updates for better description of configuration requirements</td>
<td>29-Aug-13</td>
<td>LWW</td>
</tr>
<tr class="even">
<td>3</td>
<td>Added updates for new configuration constants generated with tune on the fly.</td>
<td>10-Oct-13</td>
<td>KJS</td>
</tr>
</tbody>
</table>
