---
title: Cd_uDiag_Integration_Manual
linkTitle: Cd_uDiag_Integration_Manual
weight: 2
---

<p><a href="#dependencies">1 Dependencies <span>2</span></a></p>
<p><a href="#swcs">1.1 SWCs <span>2</span></a></p>
<p><a href="#functions-to-be-provided-to-integration-project">1.2 Functions to be provided to Integration Project <span>2</span></a></p>
<p><a href="#configuration">2 Configuration <span>3</span></a></p>
<p><a href="#build-time-config">2.1 Build Time Config <span>3</span></a></p>
<p><a href="#configuration-files-to-be-provided-by-integration-project">2.2 Configuration Files to be provided by Integration Project <span>3</span></a></p>
<p><a href="#da-vinci-parameter-configuration-changes">2.2.1 Da Vinci Parameter Configuration Changes <span>4</span></a></p>
<p><a href="#davinci-interrupt-configuration-changes">2.2.2 DaVinci Interrupt Configuration Changes <span>5</span></a></p>
<p><a href="#manual-configuration-changes">2.2.3 Manual Configuration Changes <span>5</span></a></p>
<p><a href="#integration">3 Integration <span>6</span></a></p>
<p><a href="#required-global-data-inputs">3.1 Required Global Data Inputs <span>6</span></a></p>
<p><a href="#optional-global-data-inputs">3.2 Optional Global Data Inputs <span>6</span></a></p>
<p><a href="#specific-include-path-present">3.3 Specific Include Path present <span>6</span></a></p>
<p><a href="#runnable-scheduling">4 Runnable Scheduling <span>6</span></a></p>
<p><a href="#memory-mapping">5 Memory Mapping <span>7</span></a></p>
<p><a href="#mapping">5.1 Mapping <span>7</span></a></p>
<p><a href="#usage">5.2 Usage <span>7</span></a></p>
<p><a href="#nvm-blocks">5.3 NvM Blocks <span>7</span></a></p>
<p><a href="#compiler-settings">6 Compiler Settings <span>7</span></a></p>
<p><a href="#preprocessor-macro">6.1 Preprocessor MACRO <span>7</span></a></p>
<p><a href="#optimization-settings">6.2 Optimization Settings <span>7</span></a></p>
<p><a href="#revision-control-log">7 Revision Control Log <span>8</span></a></p>
<h1 id="dependencies">Dependencies</h1>
<p>NOTE – the TMS570_uDiag component includes both uDiag and FlsTst functionality. For complete integration information on the TMS570_uDiag component, also see the FlsTst integration manual (in the TMS570_uDiag\doc folder).</p>
<h2 id="swcs">SWCs</h2>
<table>
<colgroup>
<col style="width: 30%" />
<col style="width: 69%" />
</colgroup>
<thead>
<tr class="header">
<th>Module</th>
<th>Required Feature</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TMS570_Startup</td>
<td><p>_coreGetFPSCR_()</p>
<p>_coreGetSecondaryAuxiliaryControlRegister_()</p>
<p>_coreSetSecondaryAuxiliaryControlRegister_()</p>
<p>Reset Causes</p>
<p>_fiqhandler**</p></td>
</tr>
<tr class="even">
<td>Basic System Services</td>
<td><p>EnableVFPInterrupt()*</p>
<p>EnableESMLInterrupt()***</p></td>
</tr>
<tr class="odd">
<td>Dma</td>
<td>Dma_DmaRstFail_Cnt_G_lgc****</td>
</tr>
<tr class="even">
<td>Nhet</td>
<td><p>Nhet_Htu1RstFail_Cnt_G_lgc****</p>
<p>Nhet_Htu2RstFail_Cnt_G_lgc****</p></td>
</tr>
</tbody>
</table>
<p>NOTES:</p>
<p>*When uDiagEnableFPUDiag is set to STD_OFF, the floating point exception diagnostic is disabled and EnableVFPInterrupt() is optional.</p>
<p>**_fiqhandler needed only if configuring Mcu_FpuIrq as an interrupt (see section 2.2.2).</p>
<p>*** EnableESMLInterrupt() is now called from a function in the TMS570_uDiag component, as of component version FDD32B_TMS570_uDiag_000.23. When using component version FDD32B_TMS570_uDiag_000.23 or later, any other call(s) to the EnableESMLInterrupt() function, e.g. in EcuStartup, must be removed. This fixes anomaly 6133.</p>
<p>**** DmaRstFail needed only when DMA_MPU_ENABLE is set to STD_ON; Htu1RstFail needed only when N2HET1TU_MPU_ENABLE is set to STD_ON; Htu2RstFail needed only when N2HET2TU_MPU_ENABLE is set to STD_ON. See section 2.2.3.</p>
<h2 id="functions-to-be-provided-to-integration-project">Functions to be provided to Integration Project</h2>
<p>&lt; Global function (except the ones that are defined in RTE modules) that is defined in this component but used by other function&gt;</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagFPU_Init1(void);</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagFPU_Init2(void);</p>
<p>UDIAG_COMPILER_ISR void Mcu_FpuIrq(void);</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagCCRM_Init(void);</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagClockMonitor_Init(void);</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagECC_Init(void);</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagESM_Init(void);</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagIOMM_Init(void);</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagParity_Init(void);</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagPeriphMPU_Init(void);</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagStaticRegs_Init(void);</p>
<p>FUNC(void, CD_UDIAG_APPL_CODE) uDiagVIM_Init(void);</p>
<h1 id="configuration">Configuration</h1>
<h2 id="build-time-config">Build Time Config</h2>
<table style="width:100%;">
<colgroup>
<col style="width: 36%" />
<col style="width: 53%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="header">
<th>Modules</th>
<th>Notes</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="configuration-files-to-be-provided-by-integration-project">Configuration Files to be provided by Integration Project</h2>
<h2 class="unnumbered" id="section"></h2>
<p>uDiag_Cfg.c generated from uDiag_Cfg.c.tt</p>
<p>uDiag_Cfg.h generated from uDiag_Cfg.h.tt</p>
<h3 id="da-vinci-parameter-configuration-changes">Da Vinci Parameter Configuration Changes</h3>
<table>
<colgroup>
<col style="width: 43%" />
<col style="width: 38%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Notes</th>
<th>SWC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>uDiagGeneral\uDiagEnableFPUDiag</td>
<td>When set to STD_ON,the floating point exception diagnostic is enabled. When set to STD_OFF, the diagnostic is disabled, the EnableVFPInterrupt() function (see section 1.1) is optional, interrupt configuration of Mcu_FpuIrq (see section 2.2.2) is optional, and the calls to uDiagFPU_Init1() and uDiagFPU_Init2() (see section 4) are optional.</td>
<td>TMS570_uDiag</td>
</tr>
<tr class="even">
<td>OsOSFIQHandler\NONO_AUTO\OsOSFIQHandler</td>
<td>Must be set to “_fiqhandler” when Mcu_FpuIrq is configured as an interrupt. (See section 2.2.2).</td>
<td>Os</td>
</tr>
<tr class="odd">
<td>uDiagGeneral\uDiagGladiatorCompatible</td>
<td>Must be set to STD_ON for programs where code compatibility is required between Gladiator and Champion parts.* Set to STD_OFF for programs where only Champion parts are used.</td>
<td>TMS570_uDiag</td>
</tr>
<tr class="even">
<td>uDiagGeneral\uDiagVIMPerTrusted</td>
<td>Set to STD_ON when uDiagVIM_Per() is called from a trusted task. Set to STD_OFF when uDiagVIM_Per() is called from a non-trusted task. NOTE that when this parameter is set to STD_OFF, the void function TWrapS_uDiagVIM_RednRpdShtdn(void) must be added as a trusted function.</td>
<td>TMS570_uDiag</td>
</tr>
<tr class="odd">
<td>uDiagGeneral\uDiagECCPerTrusted</td>
<td>Set to STD_ON when uDiagECC_Per() is called from a trusted task. Set to STD_OFF when uDiagECC_Per() is called from a non-trusted task. NOTE that when this parameter is set to STD_OFF, the void function TWrapS_uDiagECC_RednRpdShtdn(void) must be added as a trusted function.</td>
<td>TMS570_uDiag</td>
</tr>
</tbody>
</table>
<p>*The uDiagGladiatorCompatible parameter selects ESM Group 1 Channel 7 (as used on Gladiator) vs Group 1 Channel 34 (as used on Champion) for NHET2 Parity Error. On programs where code compatibility is required, the Gladiator ESM configuration must be used, because the Champion configuration enables an interrupt that is Reserved for Gladiator. NOTE that on Champion parts running code configured as Gladiator-compatible, an NHET2 RAM Parity Error will trigger only a Critical Registers Verification Fault , with no NHET2 RAM Fault diagnostic.</p>
<h3 id="davinci-interrupt-configuration-changes">DaVinci Interrupt Configuration Changes</h3>
<table style="width:100%;">
<colgroup>
<col style="width: 17%" />
<col style="width: 9%" />
<col style="width: 38%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th>ISR Name</th>
<th>VIM #</th>
<th>Priority Dependency</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mcu_FpuIrq</td>
<td>47</td>
<td>higher priority than any other FIQ that uses floating point</td>
<td>Must be an FIQ and Category 1 when configured, and if FIRQPR0 is included in the runtime register check, its value needs to be changed in the RuntimeRegCheck configuration. When uDiagEnableFPUDiag is set to STD_OFF, the floating point exception diagnostic is disabled and the interrupt configuration of Mcu_FpuIrq is optional.</td>
</tr>
<tr class="even">
<td>Isr_ESMH</td>
<td>0</td>
<td>Highest priority FIQ</td>
<td>Must be FIQ and Category 1</td>
</tr>
<tr class="odd">
<td>Isr_ESML</td>
<td>20</td>
<td></td>
<td>Must be IRQ and Category 2</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="manual-configuration-changes">Manual Configuration Changes</h3>
<table>
<colgroup>
<col style="width: 39%" />
<col style="width: 45%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="header">
<th>Constant</th>
<th>Notes</th>
<th>SWC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>N2HET1_PARITY_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="even">
<td>N2HET2_PARITY_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="odd">
<td>N2HET1TU_PARITY_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="even">
<td>N2HET2TU_PARITY_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="odd">
<td>MIBADC1_PARITY_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="even">
<td>MIBADC2_PARITY_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="odd">
<td>DCAN1_PARITY_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="even">
<td>DCAN2_PARITY_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="odd">
<td>VIM_PARITY_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="even">
<td>DMA_PARITY_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="odd">
<td>DMA_MPU_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="even">
<td>N2HET1TU_MPU_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
<tr class="odd">
<td>N2HET2TU_MPU_ENABLE</td>
<td>*See note</td>
<td>Appinit_cfg.h</td>
</tr>
</tbody>
</table>
<p>*Note – these enable parameters must be defined for the TMS570_uDiag component. They should be #defined to either STD_ON or STD_OFF as directed for the specific application/integration project; in general they will be on when the corresponding peripheral is used and off when it is not used, but there are application-specific exceptions. Some of the enable parameters are also used by other components. In addition, there may be other similar enable parameters used by other components which are not currently used in the uDiag component.</p>
<h1 id="integration">Integration</h1>
<h2 id="required-global-data-inputs">Required Global Data Inputs</h2>
<p>&lt;Mention any global variable that this component requires from other components&gt;</p>
<p>ResetCause_Cnt_Enum</p>
<p>Dma_DmaRstFail_Cnt_G_lgc (when DMA_MPU_ENABLE is set to STD_ON)</p>
<p>Nhet_Htu1RstFail_Cnt_G_lgc (when N2HET1TU_MPU_ENABLE is set to STD_ON)</p>
<p>Nhet_Htu2RstFail_Cnt_G_lgc (when N2HET2TU_MPU_ENABLE is set to STD_ON)</p>
<h2 id="optional-global-data-inputs">Optional Global Data Inputs</h2>
<p>&lt;Mention any global variable that this component requires for other components&gt;</p>
<h2 id="specific-include-path-present">Specific Include Path present</h2>
<p>&lt;Yes&gt;</p>
<h1 id="runnable-scheduling">Runnable Scheduling </h1>
<p>This section specifies the required runnable scheduling.</p>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 47%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Init</th>
<th>Scheduling Requirements</th>
<th>Trigger</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>uDiagCCRM_Init</td>
<td>Before the OS is started</td>
<td>ECU Startup</td>
</tr>
<tr class="even">
<td>uDiagClockMonitor_Init</td>
<td>Before the OS is started</td>
<td>ECU Startup</td>
</tr>
<tr class="odd">
<td>uDiagECC_Init</td>
<td>Before the OS is started</td>
<td>ECU Startup</td>
</tr>
<tr class="even">
<td>uDiagESM_Init</td>
<td>Before the OS is started</td>
<td>ECU Startup</td>
</tr>
<tr class="odd">
<td>uDiagIOMM_Init</td>
<td>Before the OS is started</td>
<td>ECU Startup</td>
</tr>
<tr class="even">
<td>uDiagParity_Init</td>
<td>Before the OS is started</td>
<td>ECU Startup</td>
</tr>
<tr class="odd">
<td>uDiagPeriphMPU_Init</td>
<td>Before the OS is started</td>
<td>ECU Startup</td>
</tr>
<tr class="even">
<td>uDiagStaticRegs_Init</td>
<td>Before the OS is started</td>
<td>ECU Startup</td>
</tr>
<tr class="odd">
<td>uDiagVIM_Init</td>
<td>Before the OS is started</td>
<td>ECU Startup</td>
</tr>
<tr class="even">
<td>uDiagFPU_Init1*</td>
<td>Before the OS is started</td>
<td>ECU Startup</td>
</tr>
<tr class="odd">
<td>uDiagFPU_Init2*</td>
<td>After the OS is started, before any code that uses floating point</td>
<td>ECU Startup</td>
</tr>
<tr class="even">
<td>uDiagPeriphStartup_Init</td>
<td>After DiagMgr initialization</td>
<td>RTE (Init)</td>
</tr>
<tr class="odd">
<td>uDiagResetHandler_Init</td>
<td>After DiagMgr initialization</td>
<td>RTE (Init)</td>
</tr>
</tbody>
</table>
<p>*NOTE: When uDiagEnableFPUDiag is set to STD_OFF, the floating point exception diagnostic is disabled and the calls to uDiagFPU_Init1() and uDiagFPU_Init2() are optional.</p>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 53%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header">
<th>Runnable</th>
<th>Scheduling Requirements</th>
<th>Trigger</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt;Runnable name&gt;</td>
<td>None</td>
<td>RTE/ISR(&lt;time&gt;ms)</td>
</tr>
</tbody>
</table>
<h1 id="memory-mapping">Memory Mapping</h1>
<h2 id="mapping">Mapping</h2>
<table>
<colgroup>
<col style="width: 65%" />
<col style="width: 27%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr class="header">
<th>Memory Section</th>
<th>Contents</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>UDIAG_START_SEC_VAR_SAVED_UNSPECIFIED</td>
<td>FPUExceptionAddr_Cnt_D_u32</td>
<td>do not clear on reset</td>
</tr>
<tr class="even">
<td>UDIAG_START_SEC_VAR_CLEARED_UNSPECIFIED</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>UDIAG_START_SEC_VAR_CLEARED_BOOLEAN</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>UDIAG_START_SEC_VAR_CLEARED_16</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>UDIAG_START_SEC_VAR_CLEARED_32</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>WDGRESETHANDLER_START_SEC_VAR_POWER_ON_CLEARED_8</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>* Each …START_SEC… constant is terminated by a …STOP_SEC… constant as specified in the AUTOSAR Memory Mapping requirements.</p>
<h2 id="usage">Usage</h2>
<table>
<colgroup>
<col style="width: 55%" />
<col style="width: 23%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>RAM</th>
<th>ROM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt;Memmap usuage info&gt;</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Table 1: ARM Cortex R4 Memory Usage</p>
<h2 id="nvm-blocks">NvM Blocks</h2>
<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="header">
<th>Block Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt;NvM Block Info&gt;</td>
</tr>
</tbody>
</table>
<p>Note : Size of the NVM block if configured in developer</p>
<h1 id="compiler-settings">Compiler Settings</h1>
<h2 id="preprocessor-macro"> Preprocessor MACRO</h2>
<p>&lt;Define all the preprocessor Macros needed and conditions when needed&gt;.</p>
<h2 id="optimization-settings">Optimization Settings</h2>
<h2 class="unnumbered" id="section-1"></h2>
<h1 id="revision-control-log">Revision Control Log</h1>
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 60%" />
<col style="width: 12%" />
<col style="width: 19%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Rev #</strong></td>
<td><strong>Change Description</strong></td>
<td><strong>Date</strong></td>
<td><strong>Author</strong></td>
</tr>
<tr class="even">
<td>1</td>
<td>Initial version – includes information for Cd_uDiagFPU and Cd_uDiagUtility only</td>
<td>6-Jun-2013</td>
<td>Kathleen Creager</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Added uDiagGeneral\uDiagEnableFPUDiag to configuration parameters, and related notes, for enabling/disabling floating point exception diagnostic. Added “Category 1” and mention of Runtime Register Check to notes on configuring Mcu_FpuIrq. Added OsOSFIQHandler configuration parameter. Clarified scheduling requirements on uDiagFPU_Init2().</td>
<td>26-Jun-13</td>
<td>KMC</td>
</tr>
<tr class="even">
<td>3</td>
<td>Added information on parameters uDiagGladiatorCompatible and uDiagVIMPerTrusted,FlsTstBlockSize, interrupt routines, and optimization settings as needed for changes made to fix anomalies 5403, 5801, 5491, 5809, and 5810. NOTE that this integration manual is not complete; it includes only information related to changes made to the component beginning in June 2013..</td>
<td>16-Oct-13</td>
<td>KMC</td>
</tr>
<tr class="odd">
<td>4</td>
<td>Updated for change to call init functions from EcuStartup instead of as RTE init functions, and removed unneeded instructions about inlining compiler directive, both changes per CR11158. Added dependency and note regarding EnableESMLInterrupt() per CR 11157. Other misc cleanup.</td>
<td>06-Jan-14</td>
<td>KMC</td>
</tr>
<tr class="even">
<td>5</td>
<td>Added uDiagPeriphMPU_Init runnable, added PARITY_ENABLE and MPU_ENABLE configuration parameters</td>
<td>09-Apr-14</td>
<td>KMC</td>
</tr>
<tr class="odd">
<td>6</td>
<td>Added uDiagPeriphStartup_Init runnable and related dependencies and global variables</td>
<td>31-Jan-15</td>
<td>KMC</td>
</tr>
</tbody>
</table>
